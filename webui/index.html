<!doctype html>
<html lang="cs">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FURA</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; max-width: 880px }
    textarea, input, button { font: inherit }
    textarea { width: 100%; min-height: 120px }
    .row { display: grid; grid-template-columns: 1fr auto; gap: .5rem; align-items: center }
    .out { white-space: pre-wrap; background: #0b1020; color: #e7ecff; padding: 1rem; border-radius: .5rem; min-height: 4rem }
    .muted { color: #5b6377; font-size: .9rem }
    .ok { color: #1b8a2f }
    .bad { color: #b21a1a }
  </style>
  <body>
    <h1>Otec Fura</h1>

    <div class="row" style="margin:.5rem 0 1rem">
      <label>Model:</label>
      <input id="model" value="llama3:8b" />
    </div>

    <textarea id="msg" placeholder="Sem napiš dotaz…"></textarea>
    <div style="margin-top:.5rem">
      <button onclick="sendAsk()">Odeslat</button>
      <span class="muted">Pošle <code>POST /ask</code> na tento backend.</span>
    </div>

    <h3>Odpověď</h3>
    <pre id="out" class="out"></pre>

    <h3>Zdraví</h3>
    <code id="hz" class="muted">načítám…</code>

    <script>
      async function sendAsk() {
        const body = {
          message: document.getElementById('msg').value,
          model: document.getElementById('model').value
        };
        const r = await fetch('/ask', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(body)
        });
        const data = await r.json().catch(()=>({}));
        const text = data.response ?? JSON.stringify(data, null, 2);
        document.getElementById('out').textContent = text;
      }

      (async function ping(){
        try {
          const r = await fetch('/healthz');
          const j = await r.json();
          const ok = j?.model_gateway?.ok ?? j?.model_gateway?.ollama_ok ?? j?.ok;
          document.getElementById('hz').textContent = ok ? 'OK' : 'NOT OK';
          document.getElementById('hz').className = ok ? 'ok' : 'bad';
        } catch(e) {
          document.getElementById('hz').textContent = 'ERR';
          document.getElementById('hz').className = 'bad';
        }
      })();
    </script>
  </body>
</html>
