<!doctype html>
<meta charset="utf-8">
<title>FURA</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; }
  h1 { margin-top: 0; }
  .row { margin: 8px 0; }
  input[type=text] { padding: 6px 8px; width: 280px; }
  textarea { width: 100%; max-width: 860px; height: 140px; padding: 8px; }
  button { padding: 8px 14px; cursor: pointer; }
  .out { white-space: pre-wrap; background:#f6f8fa; padding:12px; border-radius:8px; max-width:860px;}
  .hint { color:#666; font-size: 12px; }
</style>

<h1>FURA UI</h1>

<div class="row">
  <label>Model: <input id="model" type="text" value="llama3:8b"></label>
</div>
<div class="row">
  <label>X-API-Key: <input id="apikey" type="text" placeholder="(volitelné)"></label>
  <span class="hint">uloží se do localStorage</span>
</div>
<div class="row">
  <textarea id="prompt" placeholder="Zadej dotaz"></textarea>
</div>
<div class="row">
  <button id="btnAsk">Odeslat /ask</button>
  <button id="btnChat">Odeslat /v1/chat</button>
</div>

<h3>Výstup</h3>
<pre id="out" class="out"></pre>

<script>
const $ = (id) => document.getElementById(id);

(function init() {
  $('apikey').value = localStorage.getItem('FURA_API_KEY') || '';
  $('btnAsk').addEventListener('click', doAsk);
  $('btnChat').addEventListener('click', doChat);
  $('apikey').addEventListener('change', () => {
    localStorage.setItem('FURA_API_KEY', $('apikey').value.trim());
  });
})();

async function doAsk(){
  const body = {
    message: $('prompt').value,
    model: $('model').value
  };
  await call('/ask', body);
}

async function doChat(){
  const body = {
    model: $('model').value,
    messages: [{role: 'user', content: $('prompt').value}]
  };
  await call('/v1/chat', body);
}

async function call(path, body){
  $('out').textContent = '⏳ Odesílám...';
  const headers = {'Content-Type': 'application/json'};
  const key = ($('apikey').value || '').trim();
  if (key) headers['X-API-Key'] = key;
  try{
    const r = await fetch(path, {method:'POST', headers, body: JSON.stringify(body)});
    const t = await r.text();
    $('out').textContent = t;
  }catch(e){
    $('out').textContent = String(e);
  }
}
</script>
